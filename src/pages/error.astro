---
// src/pages/error.astro
import Layout from '../layouts/Layout.astro';

const url = Astro.url;
const errorType = url.searchParams.get('type') || 'unknown';
const message = url.searchParams.get('message') || '';

const errorInfo = {
  auth: {
    title: 'Error de Autenticaci√≥n',
    description: 'Hubo un problema con tu sesi√≥n de usuario',
    icon: 'üîê',
    color: 'red'
  },
  permission: {
    title: 'Sin Permisos',
    description: 'No tienes permisos para acceder a esta funci√≥n',
    icon: '‚õî',
    color: 'orange'
  },
  network: {
    title: 'Error de Conexi√≥n',
    description: 'No se pudo conectar con el servidor',
    icon: 'üì°',
    color: 'blue'
  },
  unknown: {
    title: 'Error Inesperado',
    description: 'Ocurri√≥ un error inesperado en el sistema',
    icon: '‚ö†Ô∏è',
    color: 'gray'
  }
};

const error = errorInfo[errorType] || errorInfo.unknown;
---

<Layout 
  title={`${error.title} | Club Canino Dos Huellitas`}
  description={error.description}
>
  <div class="min-h-screen bg-gradient-to-br from-[#FFFBF0] to-[#ACF0F4] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-md w-full space-y-8 text-center">
      <!-- Icono de error -->
      <div class="flex justify-center">
        <div class={`w-24 h-24 rounded-full flex items-center justify-center bg-${error.color}-100`}>
          <span class="text-4xl">{error.icon}</span>
        </div>
      </div>

      <!-- Informaci√≥n del error -->
      <div class="space-y-4">
        <h1 class="text-3xl font-bold text-[#2C3E50]">
          {error.title}
        </h1>
        <p class="text-lg text-gray-600">
          {error.description}
        </p>
        {message && (
          <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
            <p class="text-sm text-yellow-800">{message}</p>
          </div>
        )}
      </div>

      <!-- Acciones -->
      <div class="space-y-4">
        {errorType === 'auth' && (
          <div class="space-y-3">
            <a
              href="/login"
              class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-[#56CCF2] hover:bg-[#5B9BD5] transition-colors"
            >
              Iniciar Sesi√≥n Nuevamente
            </a>
            <a
              href="/"
              class="w-full flex justify-center py-3 px-4 border border-[#56CCF2] rounded-lg text-sm font-medium text-[#56CCF2] bg-white hover:bg-gray-50 transition-colors"
            >
              Volver al Inicio
            </a>
          </div>
        )}

        {errorType === 'permission' && (
          <div class="space-y-3">
            <a
              href="/dashboard"
              class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-[#56CCF2] hover:bg-[#5B9BD5] transition-colors"
            >
              Ir a Mi Dashboard
            </a>
            <a
              href="https://wa.me/573144329824"
              target="_blank"
              rel="noopener noreferrer"
              class="w-full flex justify-center py-3 px-4 border border-[#56CCF2] rounded-lg text-sm font-medium text-[#56CCF2] bg-white hover:bg-gray-50 transition-colors"
            >
              Contactar Soporte
            </a>
          </div>
        )}

        {(errorType === 'network' || errorType === 'unknown') && (
          <div class="space-y-3">
            <button
              onclick="window.location.reload()"
              class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-[#56CCF2] hover:bg-[#5B9BD5] transition-colors"
            >
              Intentar Nuevamente
            </button>
            <a
              href="/"
              class="w-full flex justify-center py-3 px-4 border border-[#56CCF2] rounded-lg text-sm font-medium text-[#56CCF2] bg-white hover:bg-gray-50 transition-colors"
            >
              Volver al Inicio
            </a>
          </div>
        )}
      </div>

      <!-- Informaci√≥n de contacto -->
      <div class="pt-6 border-t border-gray-200">
        <p class="text-sm text-gray-500 mb-3">
          ¬øNecesitas ayuda adicional?
        </p>
        <div class="flex justify-center space-x-4">
          <a
            href="https://wa.me/573144329824"
            target="_blank"
            rel="noopener noreferrer"
            class="text-[#56CCF2] hover:text-[#5B9BD5] transition-colors"
          >
            <span class="sr-only">WhatsApp</span>
            üí¨ WhatsApp
          </a>
          <a
            href="mailto:clubcaninodoshuellitas@gmail.com"
            class="text-[#56CCF2] hover:text-[#5B9BD5] transition-colors"
          >
            <span class="sr-only">Email</span>
            üìß Email
          </a>
        </div>
      </div>
    </div>
  </div>
</Layout>

---
// src/pages/unauthorized.astro
import Layout from '../layouts/Layout.astro';

// Obtener informaci√≥n del usuario si existe
const { locals } = Astro;
const userRole = locals.profile?.role || 'desconocido';
const userName = locals.profile?.full_name || locals.user?.email || 'Usuario';
---

<Layout 
  title="Acceso No Autorizado | Club Canino Dos Huellitas"
  description="No tienes permisos para acceder a esta p√°gina del Club Canino Dos Huellitas"
>
  <div class="min-h-screen bg-gradient-to-br from-[#FFFBF0] to-[#ACF0F4] flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-lg w-full space-y-8 text-center">
      <!-- Icono de acceso denegado -->
      <div class="flex justify-center">
        <div class="w-24 h-24 rounded-full flex items-center justify-center bg-red-100">
          <span class="text-4xl">üö´</span>
        </div>
      </div>

      <!-- Informaci√≥n -->
      <div class="space-y-4">
        <h1 class="text-3xl font-bold text-[#2C3E50]">
          Acceso No Autorizado
        </h1>
        <p class="text-lg text-gray-600">
          No tienes permisos para acceder a esta p√°gina
        </p>
        
        {locals.user && (
          <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
            <p class="text-sm text-blue-800">
              <strong>Usuario:</strong> {userName}<br>
              <strong>Rol:</strong> {userRole}
            </p>
          </div>
        )}
      </div>

      <!-- Explicaci√≥n por rol -->
      <div class="bg-white rounded-lg p-6 text-left">
        <h3 class="font-semibold text-[#2C3E50] mb-3">
          Accesos disponibles para tu rol:
        </h3>
        
        {userRole === 'padre' && (
          <ul class="space-y-2 text-sm text-gray-600">
            <li>‚úÖ Dashboard personal</li>
            <li>‚úÖ Ver tus mascotas</li>
            <li>‚úÖ Crear evaluaciones de casa</li>
            <li>‚úÖ Ver fotos de tus mascotas</li>
            <li>‚úÖ Progreso y reportes personales</li>
          </ul>
        )}

        {userRole === 'profesor' && (
          <ul class="space-y-2 text-sm text-gray-600">
            <li>‚úÖ Dashboard del profesor</li>
            <li>‚úÖ Ver todos los estudiantes</li>
            <li>‚úÖ Crear evaluaciones del colegio</li>
            <li>‚úÖ Subir fotos</li>
            <li>‚úÖ Generar reportes</li>
            <li>‚ùå Funciones administrativas</li>
          </ul>
        )}

        {userRole === 'admin' && (
          <div class="text-yellow-600">
            <p class="text-sm">
              Como administrador deber√≠as tener acceso a todo. 
              Esto puede ser un error del sistema.
            </p>
          </div>
        )}
      </div>

      <!-- Acciones -->
      <div class="space-y-4">
        {userRole === 'padre' && (
          <a
            href="/dashboard/padre"
            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-[#56CCF2] hover:bg-[#5B9BD5] transition-colors"
          >
            Ir a Mi Dashboard
          </a>
        )}

        {userRole === 'profesor' && (
          <a
            href="/dashboard/profesor"
            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-[#56CCF2] hover:bg-[#5B9BD5] transition-colors"
          >
            Ir al Dashboard del Profesor
          </a>
        )}

        {userRole === 'admin' && (
          <a
            href="/dashboard/admin"
            class="w-full flex justify-center py-3 px-4 border border-transparent rounded-lg text-sm font-medium text-white bg-[#56CCF2] hover:bg-[#5B9BD5] transition-colors"
          >
            Ir al Dashboard Admin
          </a>
        )}

        <a
          href="/"
          class="w-full flex justify-center py-3 px-4 border border-[#56CCF2] rounded-lg text-sm font-medium text-[#56CCF2] bg-white hover:bg-gray-50 transition-colors"
        >
          Volver al Inicio
        </a>

        <div class="pt-4">
          <p class="text-sm text-gray-500 mb-3">
            ¬øCrees que esto es un error?
          </p>
          <a
            href="https://wa.me/573144329824"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center text-[#56CCF2] hover:text-[#5B9BD5] transition-colors"
          >
            üí¨ Contactar Soporte por WhatsApp
          </a>
        </div>
      </div>

      <!-- Informaci√≥n de logout -->
      {locals.user && (
        <div class="pt-6 border-t border-gray-200">
          <p class="text-sm text-gray-500 mb-3">
            ¬øQuieres cambiar de cuenta?
          </p>
          <form action="/api/auth/logout" method="post" style="display: inline;">
            <button
              type="submit"
              class="text-red-600 hover:text-red-800 transition-colors text-sm"
            >
              üö™ Cerrar Sesi√≥n
            </button>
          </form>
        </div>
      )}
    </div>
  </div>
</Layout>